<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search | China University Selector</title>
    <meta name="description" content="Search articles across China University Selector: application tips, visa guides, scholarships, and life in China.">
    <meta name="robots" content="noindex,follow">
    <link rel="canonical" href="https://findchinaschool.com/search.html">
    <link rel="icon" href="logo.png" type="image/png">
    <link rel="apple-touch-icon" href="logo.png">
    <link rel="stylesheet" href="styles.css">

    <style>
        .search-container { background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:1rem; margin:1rem 0; }
        .search-input { width:100%; padding:0.75rem 1rem; border:1px solid #d1d5db; border-radius:8px; font-size:1rem; }
        .search-hint { color:#6b7280; font-size:0.875rem; margin-top:0.5rem; }
        .results { margin:1.5rem 0; display:grid; grid-template-columns:repeat(auto-fit, minmax(320px,1fr)); gap:1rem; }
        .result-card { background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:1rem; transition:box-shadow .2s ease; }
        .result-card:hover { box-shadow:0 8px 24px rgba(0,0,0,0.08); }
        .result-title { margin:0 0 .25rem 0; font-weight:700; color:#111827; font-size:1.05rem; }
        .result-desc { color:#6b7280; font-size:0.95rem; margin:.25rem 0 .5rem; }
        .result-meta { color:#6b7280; font-size:0.8rem; }
        .highlight { background: #fff3bf; }
        .no-results { text-align:center; color:#6b7280; padding:2rem 0; }
    </style>

    <!-- Defer Fuse.js and search initialization -->
    <script>
    window.addEventListener('load', function(){
        // Load Fuse.js lazily
        var s = document.createElement('script');
        s.src = 'https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.min.js';
        s.async = true;
        s.onload = initSearch;
        document.head.appendChild(s);
    });

    function getQueryParam(name){
        const url = new URL(window.location.href);
        return url.searchParams.get(name) || '';
    }

    function initSearch(){
        fetch('search-index.json', { cache: 'no-store' })
            .then(r => r.json())
            .then(index => {
                const options = {
                    keys: ['title','description','tags','section'],
                    threshold: 0.35,
                    ignoreLocation: true
                };
                const fuse = new Fuse(index.items, options);
                const input = document.getElementById('searchInput');
                const q = getQueryParam('q');
                if (q) { input.value = q; doSearch(fuse, q); }
                input.addEventListener('input', function(){
                    const v = this.value.trim();
                    if (!v) { renderResults([]); return; }
                    doSearch(fuse, v);
                });
            })
            .catch(err => console.error('Search index load failed', err));
    }

    function doSearch(fuse, query){
        const results = fuse.search(query, { limit: 50 }).map(r => r.item);
        renderResults(results, query);
    }

    function renderResults(items, query){
        const container = document.getElementById('results');
        container.innerHTML = '';
        if (!items || items.length === 0){
            container.innerHTML = '<div class="no-results">No results found.</div>';
            return;
        }
        const frag = document.createDocumentFragment();
        items.forEach(it => {
            const card = document.createElement('div');
            card.className = 'result-card';
            card.innerHTML = `
                <a href="${it.url}" class="result-title">${escapeHtml(it.title)}</a>
                <div class="result-desc">${highlight(escapeHtml(it.description || ''), query)}</div>
                <div class="result-meta">${it.section || ''} ‚Ä¢ ${Array.isArray(it.tags)?it.tags.join(', '):''}</div>
            `;
            frag.appendChild(card);
        });
        container.appendChild(frag);
    }

    function highlight(text, query){
        if (!query) return text;
        try {
            const re = new RegExp('('+query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')+')','ig');
            return text.replace(re,'<span class="highlight">$1</span>');
        } catch(e){ return text; }
    }
    function escapeHtml(str){
        return str.replace(/[&<>"]/g, function(c){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]); });
    }
    </script>
</head>
<body>
    <nav class="navigation">
        <div class="nav-container">
            <div class="nav-links">
                <a href="index.html">Home</a>
                <a href="about.html">About</a>
                <a href="guide.html">Guide</a>
                <a href="universities.html">Universities</a>
                <a href="blog.html" class="active">Blog</a>
                <a href="china_study_test.html">Study Test</a>
                <a href="csca-test/index.html">CSCA Section</a>
                <a href="help_us.html" class="donate-link">üíù Help Us</a>
            </div>
        </div>
    </nav>

    <div class="blog-container">
        <div class="category-header">
            <h1>üîé Search</h1>
            <p>Search articles across Application Tips, Visa, Scholarships, and Life in China.</p>
        </div>

        <div class="search-container">
            <input id="searchInput" class="search-input" type="search" placeholder="Search articles, e.g., CSC, K visa, SJTU, 211...">
            <div class="search-hint">Tip: results load as you type. You can also use ?q=keyword in the URL.</div>
        </div>

        <div id="results" class="results"></div>
    </div>

    <script src="script.js"></script>
</body>
</html>


